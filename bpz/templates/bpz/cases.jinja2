{% extends "bpz/base.jinja2" %}

{% block content %}
  <div id="map-canvas" class="navbar navbar-fixed-top" > </div>
  <divlass="panel panel-default">
    <div class="panel-heading">Cases</div>
    <ul id="case-list" class="list-group"></ul>
  </div>
{% block body_js -%}
  <script>
    $(document).ready(function () {
       
        bpz.api.cases().done(function (data) {
    
          bpz.map.featureLayer.setGeoJSON(data);

          var ul = d3.select("#case-list")
    
          cases = ul.selectAll("li")
            .data(data.features)
            .enter()
            .append("li")
              .classed("list-group-item",true)
            .append("div")
              .classed("media",true)
      
            cases
              .append("div")
              .classed("pull-left",true)
              .insert("svg")
                .classed("media-object",true)
                .attr({width:50,height:50})
                .insert("path")
                    .attr({
                      d: d3.geo.path(),
                      id: function (d,i) {
                        return "path"+i
                      },
                      class: "leaflet-clickable",
                      transform: function (d,i,e) {
                        bb=this.getBBox()
                        scale = (40/Math.max(bb.height,bb.width))
                        tx = -bb.x*scale
                        ty = -bb.y*scale
                        return "translate("+tx+","+ty+") scale("+scale+")"
                      },

                    })

            cases
              .insert("div")
                .classed("media-body",true)
                .text(function (d,i) {
                text=""
                for (prop in d.properties){
                  text += prop + " : " + d.properties[prop] 
                }
                return text
              })

          bpz.map.featureLayer.on('click',function (e) {
      
            bpz.map.fitBounds(e.layer.getBounds(),{maxZoom:16,animate:true})

          })
    
          }
        )
    })

  </script>
{%- endblock body_js %}


{% endblock content %}



  
  



